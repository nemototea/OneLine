# テスト手順書

## 目的
チュートリアル画面のフリッカー修正が正しく動作することを確認する

## テストケース

### 1. 初回起動時のテスト
**前提条件**: アプリを初めてインストールした状態

**手順**:
1. アプリを起動する
2. チュートリアル画面が表示されることを確認
3. チュートリアルをスキップまたは完了する
4. メイン画面（日記一覧）が表示されることを確認

**期待結果**:
- ✅ チュートリアル画面が表示される
- ✅ フリッカーやちらつきがない
- ✅ スムーズにメイン画面に遷移する

### 2. 既存ユーザーの起動テスト（ローカルモード）
**前提条件**: アプリをインストール済みで、ローカルモードで設定済み

**手順**:
1. アプリを完全に終了する
2. アプリを起動する
3. 画面遷移を注意深く観察する

**期待結果**:
- ✅ チュートリアル画面が一瞬も表示されない
- ✅ 直接メイン画面（日記一覧）が表示される
- ✅ スムーズな起動（フリッカーなし）

### 3. 既存ユーザーの起動テスト（Gitモード）
**前提条件**: アプリをインストール済みで、Git連携モードで設定済み

**手順**:
1. アプリを完全に終了する
2. アプリを起動する
3. 画面遷移を注意深く観察する

**期待結果**:
- ✅ チュートリアル画面が一瞬も表示されない
- ✅ 直接メイン画面（日記一覧）が表示される
- ✅ スムーズな起動（フリッカーなし）

### 4. ウィジェットからの起動テスト
**前提条件**: アプリがインストール済みで、ウィジェットが配置されている

**手順**:
1. ホーム画面からウィジェットをタップする
2. アプリが起動することを確認
3. 画面遷移を観察する

**期待結果**:
- ✅ チュートリアル画面が表示されない
- ✅ ウィジェットで指定された画面（日記一覧または新規作成）に遷移する
- ✅ スムーズな起動

### 5. 設定データがない状態でのテスト
**前提条件**: アプリデータをクリアした状態

**手順**:
1. アプリの設定からアプリデータをクリアする
2. アプリを起動する
3. チュートリアル画面が表示されることを確認

**期待結果**:
- ✅ チュートリアル画面が表示される（初回起動と同じ動作）
- ✅ フリッカーなし

### 6. パフォーマンステスト
**前提条件**: 様々な端末で確認

**手順**:
1. 低スペック端末でアプリを起動する
2. 高スペック端末でアプリを起動する
3. 起動速度と画面遷移のスムーズさを確認

**期待結果**:
- ✅ どの端末でもフリッカーが発生しない
- ✅ 起動速度に大きな影響がない
- ✅ ローディング時間が体感できるほど長くない

## デバッグのヒント

### フリッカーが発生している場合
1. Logcatで`MainActivity`のログを確認
2. `isFirstLaunch`の値の変化を確認
3. `LaunchedEffect`の実行タイミングを確認

### チュートリアルが表示されない場合
1. DataStoreの設定値を確認
2. `RepositoryManager.hasValidSettings()`の戻り値を確認
3. アプリデータをクリアして再テスト

### アプリがクラッシュする場合
1. Logcatでスタックトレースを確認
2. `isFirstLaunch!!`で非nullアサーションエラーが発生していないか確認
3. 早期リターンのロジックが正しく動作しているか確認

## 自動テストの追加（推奨）

以下のテストケースを追加することを推奨:

```kotlin
@Test
fun `初回起動時はチュートリアル画面が開始画面として設定される`() {
    // SettingsManagerのモックで hasValidSettings() が false を返す
    // isFirstLaunch が true になることを確認
}

@Test
fun `既存ユーザーは日記一覧が開始画面として設定される`() {
    // SettingsManagerのモックで hasValidSettings() が true を返す
    // isFirstLaunch が false になることを確認
}
```

## 注意事項
- テストは必ず実機で行うこと（エミュレータでは動作が異なる可能性がある）
- 異なるAndroidバージョンでテストすること（特にAPI 28-35）
- 画面録画やスクリーンショットで変更前後を比較すること
